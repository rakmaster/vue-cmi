/**
 * vue-ol
 * by Logan on 4/4/17.
 *
 * a plugin for Vue.js for Openlayers 3
 */
function plugin(a){if(plugin.installed)return!1;var b=a.extend({template:"<div></div>",props:{mapdata:Object},data:function(){return this.mapdata}});a.component("v-map",b),a.map=new map,a.prototype.$ol={map:function(c,d){return a.map.draw(c,d)},layer:{getLayers:function(c){return a.map.getLayers(c)},getLayer:function(c){return a.map.getLayer(c)},draw:function(c){return a.map.layer(c)}},control:{animate:function(c){return a.map.animate(c)},panto:function(c){return a.map.panto(c)}}}}var defaults={duration:500,styles:{stroke:{color:"rgba(0,0,0,1.0)",width:1},fill:{color:"rgba(0,80,180,1.0)"},point:{font:{character:"ÔÅÅ",style:"normal",size:"18px",family:"FontAwesome",baseline:"Bottom"},color:"#000000"}}},_view=function(b,c){return new openlayers.View({center:openlayers.proj.fromLonLat(b),zoom:c})},_extents=function(a){var b=openlayers.extent.boundingExtent(a);return openlayers.proj.transformExtent(b,openlayers.proj.get("EPSG:4326"),openlayers.proj.get("EPSG:3857"))},_stroke=function(a){return new openlayers.style.Stroke({color:a.color,width:a.width})},_fill=function(a){return new openlayers.style.Fill({color:a.color})},_text=function(a,b){return new openlayers.style.Text({text:a.character,font:a.style+" "+a.size+" '"+a.family+"'",textBaseline:a.baseline,fill:_fill(b)})},_arrange=function(a){var b=defaults.styles;for(var c in defaults.styles)b[c]=defaults.styles[c];for(var d in a)if(b[d])if(null!==a[d])for(var e in a[d])b[d][e]=a[d][e];else b[d]=a[d];return b};_style=function(a){var b={},c=_arrange(a);switch(a.type){case"Point":c.image&&(b.image=c.image),c.text&&(b.text=_text(c.text,c.fill));break;case"LineString":case"MultiLineString":c.stroke&&(b.stroke=_stroke(c.stroke));break;case"MultiPoint":c.image&&(b.image=c.image),c.font&&(b.text=_text(c.text,c.fill));break;case"MultiPolygon":case"Polygon":case"GeometryCollection":case"Circle":c.stroke&&(b.stroke=_stroke(c.stroke)),c.fill&&(b.fill=_fill(c.fill))}return new openlayers.style.Style(b)};var map=function(){this.ol={},this.target="",this.center=[0,0],this.zoom=4,this.layers=[],this.defaults=defaults};map.prototype.draw=function(a,b){if(!a)return!1;if(this.target=a,b){if(b.center&&(this.center=b.center),b.zoom&&(this.zoom=b.zoom),b.extents&&(this.extents=openlayers.extent.boundingExtent(b.extents),this.extents=openlayers.proj.transformExtent(this.extents,openlayers.proj.get("EPSG:4326"),openlayers.proj.get("EPSG:3857"))),b.styles)for(var c in b.styles)if(defaults.styles[c]){var d=b.styles[c];for(var e in d)defaults.styles[c][e]=d[e]}b.base?this.layers.push(_layer.draw(b.base)):this.layers.push(_layer.draw())}else this.layers.push(_layer.draw());var f={target:this.target,layers:this.layers,view:_view(this.center,this.zoom)};return!1===b.controls&&(f.controls=[new OpenLayers.Control.Navigation,new OpenLayers.Control.ArgParser,new OpenLayers.Control.Attribution]),b.extents&&this.ol.getView().fit(this.extents,this.ol.getSize()),this.ol=new openlayers.Map(f),this.ol},map.prototype.getLayers=function(a){var b=[];return a?this.layers.forEach(function(a){a instanceof openlayers.layer.Group||b.push(a)}):this.layers.forEach(function(a){a instanceof openlayers.layer.Group?a.getLayers().forEach(function(a){b.push(a)}):b.push(a)}),b},map.prototype.getLayer=function(a){this.getLayers().forEach(function(b){if(a===b.get("name"))return b})},map.prototype.layer=function(a){a.defaultStyle=this.defaults.styles.pointStyle;var b=_layer.draw(a);return this.layers.push(b),this.ol.addLayer(b),b},map.prototype.animate=function(a,b){var c=[];a.getLayers().forEach(function(a){c.push(a)});for(var d=0,e=1;e<c.length;e++)c[e].setVisible(!1);setInterval(function(){c[d].setVisible(!c[d].getVisible()),d++,d===c.length&&(d=0),c[d].setVisible(!c[d].getVisible())},b)},map.prototype.panto=function(a){if(a.extents){var b=_extents(a.extents);this.ol.getView().fit(b,{duration:this.duration})}a.zoom&&this.ol.getView().animate({center:openlayers.proj.fromLonLat(a.center),duration:a.duration,zoom:a.zoom})};var _layer={_setStyle:function(b){var c=null;if(Array.isArray(b)){c=[];for(var d in b)c.push(__webpack_require__.i(_style(b[d])))}else c=__webpack_require__.i(_style(b));return c},draw:function(b){var c;if(b){c=(0,this[b.type])(b.name,b.src)}else c=new openlayers.layer.Tile({name:"base",source:_source.default()});return c},tile:function(b,c){var d={};return d.name=b,d.source=_source.xyz(c),new openlayers.layer.Tile(d)},image:function(b,c){var d={};return d.name=b,d.source=_source.image(c),new openlayers.layer.Image(d)},points:function(b,c){var d={};return d.name=b,d.source=_source.points(c),c.style&&(d.style=_setStyle(c.style)),new openlayers.layer.Vector(d)},shape:function(b,c){var d={};return d.name=b,d.source=_source.shape(c),c.style?d.style=_setStyle(c.style):d.style=_style({type:"Polygon"}),new openlayers.layer.Vector(d)},radius:function(b,c){var d={};return d.name=b,d.source=_source.radius(c),c.style?d.style=_setStyle(c.style):d.style=_style({type:"Polygon"}),new openlayers.layer.Vector(d)},geojson:function(b,c){var d={};return d.name=b,d.source=_source.geojson(c.coordinates),c.style?d.style=_setStyle(c.style):d.style=_style({type:"MultiPolygon"}),new ol.layer.Vector(d)},group:function(b,c){var d=[];for(var e in c){var f=_layer[c[e].type];d.push(f(c[e].name,c[e].src))}return new openlayers.layer.Group({name:b,layers:d})},empty:function(b,c){var d={};return d.name=b,c&&(d.source=c),new openlayers.layer.Vector(d)}},_source={_feature:function(a){return new openlayers.Feature({geometry:a})},_attributions:function(a){var b=[];if(a)if(Array.isArray(a))for(var c in a)b.push(new openlayers.Attribution({html:a[c]}));else{var d=new openlayers.Attribution({html:a});b.push(d)}return b},_point:function(a){var b;b=Array.isArray(a)?a:a.coordinates;var c=_source._feature(new openlayers.geom.Point(_source._normalize(b))),d=null;return a.style&&(d=a.style,d.type="Point",c.setStyle(_style(d))),c},_normalize:function(a){return openlayers.proj.transform(a,"EPSG:4326","EPSG:3857")},default:function(){return new openlayers.source.OSM},xyz:function(a){var b,c;return a.attributions&&(b=_source._attributions(a.attributions)),!!a.url&&(c=a.url,new openlayers.source.XYZ({attributions:b,url:c}))},image:function(a){var d,e,b=_source.shape(a.coordinates),c=b.getExtent();return a.attributions&&(d=_source._attributions(a.attributions)),!!a.url&&(e=a.url,new openlayers.source.ImageStatic({attributions:d,url:e,imageExtent:c}))},points:function(a){for(var b={},c=[],d=0;d<a.length;d++)c.push(_source._point(a[d]));return b.features=c,new openlayers.source.Vector(b)},shape:function(a){for(var b=[],c=0;c<a.coordinates.length;c++)b.push(_source._normalize(a.coordinates[c]));var d=_source._feature(new openlayers.geom.Polygon([b]));return new openlayers.source.Vector({features:[d]})},radius:function(a){var b=a.radius,c=[];c.degrees=1/69.048,c.dd=c.degrees,c.m=1609.344,c.ft=5280,c.km=1.609344,c.mi=1,c.inches=63360;var d=b*c[a.units]*.70710678,e=new openlayers.Coordinate(_source._normalize(a.coordinates)),f=_source._feature(new openlayers.geom.Circle(e,d));return new openlayers.source.Vector({features:f})},geojson:function(a){var b;return null!==a&&"object"==typeof a?b=new openlayers.source.Vector({features:(new openlayers.format.GeoJSON).readFeatures(a),format:new ol.format.GeoJSON}):"string"==typeof a&&(b=new openlayers.source.Vector({url:a,format:new ol.format.GeoJSON})),b}},_stroke=function(b,c){return new openlayers.style.Stroke({color:b,width:c})},_fill=function(b){return new openlayers.style.Fill({color:b})};style=function(a){var b;return"Point"===a.type&&(b={text:new openlayers.style.Text({text:a.text,font:a.font,textBaseline:a.baseline,fill:_fill({color:a.fillcolor})})}),"Polygon"===a.type&&(b={fill:_fill(a.fillcolor),stroke:_stroke(a.strokecolor,a.strokewidth)}),new openlayers.style.Style(b)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(plugin);
